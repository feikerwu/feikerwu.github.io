"use strict";!function(d){var n=function(n){this.init(n)};n.prototype={init:function(n){this.currentData=null,this.opts=d.extend({},{id:"",level:15,zoom:!1,type:[],width:0,height:0,titleClass:"",contentClass:"",showPanorama:!1,showMarkPanorama:!1,showLabel:!1,mapStyle:"normal",icon:{},centerPoint:{},index:-1,animate:!1,points:[],callback:function(){}},n),this.render()},render:function(){var n=this.opts,t=n.id,a=n.centerPoint.lng,e=n.centerPoint.lat,o=n.level,i=new BMap.Point(a,e),r=this.map=new BMap.Map(t),l=n.mapStyle;r.centerAndZoom(i,o),r.setMapStyle({style:l}),this.addControl()},addControl:function(){var n=this.opts,t=this.map,a=n.type,e=n.zoom,o=n.showPanorama,i=0<a.length?40:20;if(t.addControl(new BMap.NavigationControl),t.addControl(new BMap.ScaleControl),t.addControl(new BMap.OverviewMapControl),e&&t.enableScrollWheelZoom(!0),o){var r=new BMap.PanoramaControl;r.setOffset(new BMap.Size(12,i)),t.addControl(r)}if(0<a.length){var l=this.getMapType(a);t.addControl(new BMap.MapTypeControl({mapTypes:l}))}this.renderMarker()},renderMarker:function(){var o=this,i=this.opts,r=this.map,n=i.points,l=i.icon,s=i.animate,p=i.showLabel,c=i.callback;0<n.length&&d.each(n,function(n,t){var a=new BMap.Point(t.lng,t.lat),e=new BMap.Marker(a);l&&l.url&&(e=new BMap.Marker(a,{icon:new BMap.Icon(l.url,new BMap.Size(l.width,l.height))})),r.addOverlay(e),s&&e.setAnimation(BMAP_ANIMATION_DROP),p&&o.renderLabel(t),n===i.index&&o.openInfoWindow(t.id),e.addEventListener("click",function(){o.openInfoWindow(t.id),c&&"function"==typeof c&&c(t.id)})})},renderLabel:function(n){var t=this.map,a=n.title,e=new BMap.Point(n.lng,n.lat),o=new BMap.Label(a,{position:e,offset:new BMap.Size(0,0)});t.addOverlay(o)},getMapType:function(n){var a=[],e={"地图":BMAP_NORMAL_MAP,"卫星":BMAP_SATELLITE_MAP,"三维":BMAP_PERSPECTIVE_MAP};return d.each(n,function(n,t){t in e&&a.push(e[t])}),a},getPosition:function(a){var n=this.opts.points,e=null;return a?0<n.length&&d.each(n,function(n,t){t.id===a&&(e=t)}):e=this.currentData,e},openInfoWindow:function(n){var t=this,a=this.map,e=this.opts,o=this.getPosition(n),i=o.content,r=new BMap.Point(o.lng,o.lat),l=e.showMarkPanorama,s="",p='<div class="'+e.titleClass+'">'+o.title+"</div>";0<i.length&&d.each(i,function(n,t){s+='<div class="'+e.contentClass+'">'+t+"</div>"}),l&&(p='<div class="'+e.titleClass+'">'+o.title+'<img class="open-panorama-btn" src="img/panorama.png" style="margin-left:12px;cursor:pointer;vertical-align:sub;" title="查看全景" /></div>');var c=new BMap.InfoWindow(s,{width:e.width,height:e.height,title:p});a.openInfoWindow(c,r),setTimeout(function(){d("#"+e.id).find(".open-panorama-btn").on("click",function(){t.openPanorama(o)})},30),this.currentData=o},openPanorama:function(n){var t=this.map,a=this.opts.id,e=new BMap.Point(n.lng,n.lat),o=new BMap.Panorama(a);(new BMap.PanoramaService).getPanoramaByLocation(e,function(n){n?(o.setPosition(e),t.setPanorama(o)):alert("当前位置无全景信息！")})}},window.BaiduMap=n}(jQuery);